---
import { fetchProducts } from '../../../../lib/contentful';
import Layout from '../../../../layouts/Layout.astro';
import ProductCard from '../../../../components/ProductCard.astro';
import { categories } from '../../../../data/categories';
import Breadcrumb from '../../../../components/Breadcrumb.astro';
import { generateBreadcrumbs } from '../../../../lib/generateBreadcrumbs';

export async function getStaticPaths() {
  return categories.map((c) => ({
    params: { category: c.slug },
  }));
}

const { category } = Astro.params;
const products = (await fetchProducts()).filter(p => p.category === category);

const categoryEntry = categories.find((c) => c.slug === category);
const categoryName = categoryEntry?.name ?? category;

const breadcrumbs = generateBreadcrumbs(Astro.url.pathname);
---

<Layout title={`カテゴリ: ${categoryName}`} breadcrumbLinks={breadcrumbs}>
  <Breadcrumb slot="breadcrumb" links={breadcrumbs} />

  <h2 class="text-xl font-bold mb-6 text-center">カテゴリ: {categoryName}</h2>
  <div class="grid gap-6 grid-cols-1 sm:grid-cols-2 lg:grid-cols-3">
    {products.map((product) => (
      <ProductCard {...product} />
    ))}
  </div>
</Layout>
